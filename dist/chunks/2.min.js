(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{10:function(t,e,n){"use strict";n.r(e);var i=n(4);let s={scale:function(t,e,n){return new i.Part((function(n,s){for(let s=0;s<e.length;s++)t.triggerAttackRelease(e[s%e.length],"16n",n+s*Object(i.Time)("16n"))}),[{time:0},{time:"0:1:0"},{time:"0:2:0"},{time:"0:3:0"}])}},a=(new i.Synth).toMaster();var o=n(0);class l{constructor({chord:t,loop:e,single:n,amount:i,instance:s,start:a,stop:o,flag:l,type:r}){this.chord=t,this.loop=e,this.single=n,this.amount=i,this.instance=s,this.start=a,this.stop=o,this.flag=l,this.type=r}focus(){i.Transport.position=Object(i.Time)(this.start)-Object(i.Time)("32n"),this.instance.playing||(i.Transport.start(),i.Transport.stop(i.context.currentTime+this.amount*Object(i.Time)(`${this.single}n`)))}setFlag(){this.instance.flag=this.flag}}var r=n(6),c=n.n(r);let p;n.d(e,"instance",(function(){return m}));let m=new c.a({template:'    <div class="module progression" id="progression" isReplace="true">\n    <h1>PROGRESSION</h1>\n    <div class="progression_bar">\n        <input type="file" @input="importJson($event)" class="bar_import" />\n        <span class="bar_dec--beat">beat</span><select name="" id="" v-model="type">\n            <option v-for="type in types" :label="type" :value="type" :key="type"></option>\n        </select>\n        <span class="bar_dec--beat">bpm</span><input class="bar_input--bpm" v-model="bpm" />\n\n        <span class="bar_dec--beat">chord</span><input class="bar_input--chord"\n            v-model="input.chord" />\n        <span class="bar_dec--beat">beat</span><input class="bar_input--amount" type="number"\n            v-model="input.amount" />\n        /\n        <input class="bar_input--single" type="number" v-model="input.single" />\n        <button class="bar_add" @click="add" v-show="playing === false">＋</button><br />\n        <button class="bar_btn" @click="toggle"\n            :class="{\'button--focus\': playing}">{{playing ? "STOP" : "START"}}</button>\n        <button class="bar_export" @click="exportJson">Export↑</button>\n    </div>\n\n    <div class="progression_input--result">\n        <div v-for="item in timeline" :key="item.flag" class="result_item--wrapper">\n            <div :class="[\'result_item\', {\'result_item--focus\': (item.flag == flag)}]">\n                <div class="item_pannel" :style="{\'width\': (item.amount / item.single) * 200 +\'px\'}"\n                    @click="item.focus.call(item)">\n                    {{item.chord}} - {{item.amount + \'/\' + item.single}}\n                </div>\n                <button class="item_deleBtn" @click="remove(item)" v-show="playing === false">X</button>\n            </div>\n        </div>\n    </div>\n</div>',data:{flag:0,bpm:70,type:"scale",types:["scale"],input:{single:"4",amount:"4",chord:"CM7"},initOctive:4,timeline:[],json:[],playing:!1},watch:{bpm:{handler(t,e){var n;n=()=>{this.changeWave(),i.Transport.bpm.value=t,this.caculateTime()},clearTimeout(p),p=setTimeout(()=>{n()},500)},immediate:!0}},methods:{changeWave(){console.log("change");let t=document.querySelector(".wave--one"),e=document.querySelector(".wave--two");t.style.animationDuration=Math.ceil(360/this.bpm)+"s",e.style.animationDuration=Math.ceil(360/this.bpm)+"s"},toggle(){this.playing?this.stop():this.start()},start(){this.playing=!0,i.Transport.stop(),i.Transport.start()},stop(){this.playing=!1,this.flag=this.timeline.length-1,i.Transport.stop()},exportJson(){let t=[];for(let e of this.timeline){let{amount:n,single:i,chord:s,type:a}=e;t.push({amount:n,single:i,chord:s,type:a})}let e=JSON.stringify(t,void 0,4),n=new Blob([e],{type:"text/json"}),i=document.createEvent("MouseEvents"),s=document.createElement("a");s.download="RAD-PROGRESSION.json",s.href=window.URL.createObjectURL(n),s.dataset.downloadurl=["text/json",s.download,s.href].join(":"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),s.dispatchEvent(i)},async importJson(t){let e=await function(t){return new Promise((e,n)=>{let i=t.target.files[0],s=new FileReader;s.readAsText(i),s.onload=function(t){e(t.target.result)}})}(t),n=JSON.parse(e);for(let e of n){let n,{amount:r,single:c,chord:p,type:m}=e;try{n=Object(o.a)(p,this.initOctive)}catch(t){return void console.log(t)}if(!r.match(/^\d$/)||!c.match(/^\d$/))throw`[Rad-Club] The parameter "${r}/${c}" is not valid`;let h=Object(i.Time)(`${c}n`)*r,u=s[m](a,n,c);u.loop=3;let d=new l({chord:p,loop:u,time:h,amount:r,single:c,instance:this});this.timeline.splice(this.flag+1,0,d)}this.caculateTime()},add(){let t,{amount:e,single:n,chord:i}=this.input,r=this.type;try{t=Object(o.a)(i,this.initOctive)}catch(t){return void console.log(t)}if(!e.match(/^\d$/)||!n.match(/^\d$/))throw`[Rad-Club] The parameter "${e}/${n}" is not valid`;let c=s[r](a,t,n),p=new l({chord:i,loop:c,type:r,amount:e,single:n,instance:this});this.timeline.splice(this.flag+1,0,p),this.caculateTime(),this.timeline[p.flag].focus()},remove(t){this.timeline.splice(t.flag,1),this.caculateTime()},caculateLoop(){this.timeline[this.timeline.length-1]?(i.Transport.loopEnd=this.timeline[this.timeline.length-1].stop,i.Transport.loop=!0):i.Transport.loop=!1},caculateTime(){i.Transport.cancel();let t=Object(i.Time)(0),e=0;for(let n of this.timeline){let{loop:s,amount:a,single:o}=n,l=t,r=t+=a*Object(i.Time)(`${o}n`);n.start=l,n.stop=r,n.flag=e++,s.start(n.start),s.loop=a,i.Transport.schedule(t=>{n.setFlag()},n.start)}this.caculateLoop()}}})}}]);
//# sourceMappingURL=2.min.js.map